<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Islamic Daily Tracker</title>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        min-height: 100vh;
        color: #333;
      }

      .container {
        max-width: 1000px;
        margin: 0 auto;
        padding: 20px;
      }

      .header {
        text-align: center;
        color: white;
        margin-bottom: 30px;
      }

      .header h1 {
        font-size: 2.5em;
        margin-bottom: 10px;
        text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
      }

      .tabs {
        display: flex;
        background: rgba(255, 255, 255, 0.1);
        backdrop-filter: blur(10px);
        border-radius: 15px;
        margin-bottom: 20px;
        overflow: hidden;
      }

      .tab-button {
        flex: 1;
        padding: 15px 20px;
        background: transparent;
        border: none;
        color: white;
        cursor: pointer;
        font-size: 1em;
        font-weight: bold;
        transition: all 0.3s ease;
      }

      .tab-button.active {
        background: rgba(255, 255, 255, 0.2);
        color: #fff;
      }

      .tab-button:hover {
        background: rgba(255, 255, 255, 0.15);
      }

      .tab-content {
        display: none;
      }

      .tab-content.active {
        display: block;
      }

      .date-display {
        background: rgba(255, 255, 255, 0.1);
        backdrop-filter: blur(10px);
        border-radius: 15px;
        padding: 15px;
        margin-bottom: 20px;
        color: white;
        text-align: center;
      }

      .prayers-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
        gap: 20px;
        margin-bottom: 30px;
      }

      .prayer-card {
        background: rgba(255, 255, 255, 0.95);
        border-radius: 15px;
        padding: 20px;
        box-shadow: 0 8px 32px rgba(31, 38, 135, 0.37);
        backdrop-filter: blur(4px);
        border: 1px solid rgba(255, 255, 255, 0.18);
        transition: all 0.3s ease;
      }

      .prayer-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 12px 40px rgba(31, 38, 135, 0.5);
      }

      .prayer-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 15px;
      }

      .prayer-name {
        font-size: 1.4em;
        font-weight: bold;
        color: #4c63d2;
      }

      .prayer-time {
        font-size: 1.1em;
        color: #666;
      }

      .prayer-status {
        display: flex;
        gap: 10px;
        margin-bottom: 15px;
      }

      .status-btn {
        flex: 1;
        padding: 10px;
        border: none;
        border-radius: 8px;
        cursor: pointer;
        font-weight: bold;
        transition: all 0.3s ease;
      }

      .status-btn.prayed {
        background: #4caf50;
        color: white;
      }

      .status-btn.missed {
        background: #f44336;
        color: white;
      }

      .status-btn:not(.prayed):not(.missed) {
        background: #f0f0f0;
        color: #666;
      }

      .status-btn:hover {
        transform: scale(1.05);
      }

      .missed-count {
        text-align: center;
        color: #f44336;
        font-weight: bold;
        margin-top: 10px;
      }

      .section {
        background: rgba(255, 255, 255, 0.95);
        border-radius: 15px;
        padding: 25px;
        margin-bottom: 20px;
        box-shadow: 0 8px 32px rgba(31, 38, 135, 0.37);
      }

      .section-title {
        font-size: 1.5em;
        color: #4c63d2;
        margin-bottom: 20px;
        text-align: center;
      }

      .missed-prayer-item {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 12px;
        background: #fff5f5;
        border-radius: 8px;
        margin-bottom: 10px;
        border-left: 4px solid #f44336;
      }

      .make-up-btn {
        background: #4caf50;
        color: white;
        border: none;
        padding: 8px 15px;
        border-radius: 5px;
        cursor: pointer;
        font-weight: bold;
        transition: all 0.3s ease;
      }

      .make-up-btn:hover {
        background: #45a049;
        transform: scale(1.05);
      }

      .stats-section {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 15px;
        margin-bottom: 20px;
      }

      .stat-card {
        background: rgba(255, 255, 255, 0.95);
        border-radius: 10px;
        padding: 15px;
        text-align: center;
        box-shadow: 0 4px 15px rgba(31, 38, 135, 0.2);
      }

      .stat-value {
        font-size: 2em;
        font-weight: bold;
        color: #4c63d2;
      }

      .stat-label {
        color: #666;
        margin-top: 5px;
      }

      .calendar {
        display: grid;
        grid-template-columns: repeat(7, 1fr);
        gap: 2px;
        margin-bottom: 20px;
      }

      .calendar-header {
        display: grid;
        grid-template-columns: repeat(7, 1fr);
        gap: 2px;
        margin-bottom: 10px;
      }

      .calendar-nav {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 20px;
      }

      .nav-btn {
        background: #4c63d2;
        color: white;
        border: none;
        padding: 10px 15px;
        border-radius: 5px;
        cursor: pointer;
        font-weight: bold;
      }

      .nav-btn:hover {
        background: #3d52b8;
      }

      .day-header {
        background: #4c63d2;
        color: white;
        padding: 10px;
        text-align: center;
        font-weight: bold;
      }

      .calendar-day {
        background: white;
        border: 1px solid #ddd;
        padding: 10px;
        text-align: center;
        cursor: pointer;
        min-height: 50px;
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        transition: all 0.3s ease;
      }

      .calendar-day:hover {
        background: #f0f8ff;
      }

      .calendar-day.other-month {
        color: #ccc;
        background: #f9f9f9;
      }

      .calendar-day.selected {
        background: #4c63d2;
        color: white;
      }

      .calendar-day.has-missed {
        background: #ffe6e6;
        border-color: #f44336;
      }

      .calendar-day.today {
        background: #e8f5e8;
        border-color: #4caf50;
      }

      .day-number {
        font-weight: bold;
        margin-bottom: 2px;
      }

      .missed-indicator {
        font-size: 0.8em;
        color: #f44336;
      }

      .modal {
        display: none;
        position: fixed;
        z-index: 1000;
        left: 0;
        top: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0, 0, 0, 0.5);
      }

      .modal-content {
        background: white;
        margin: 10% auto;
        padding: 20px;
        border-radius: 15px;
        max-width: 500px;
        max-height: 80vh;
        overflow-y: auto;
      }

      .close {
        color: #aaa;
        float: right;
        font-size: 28px;
        font-weight: bold;
        cursor: pointer;
      }

      .close:hover {
        color: #000;
      }

      .prayer-checklist {
        display: grid;
        gap: 10px;
        margin-top: 15px;
      }

      .prayer-check-item {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 10px;
        background: #f9f9f9;
        border-radius: 5px;
      }

      .azkar-section {
        margin-bottom: 30px;
      }

      .azkar-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
        gap: 20px;
      }

      .azkar-card {
        background: white;
        border-radius: 10px;
        padding: 20px;
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
      }

      .azkar-title {
        font-size: 1.2em;
        font-weight: bold;
        color: #4c63d2;
        margin-bottom: 15px;
        text-align: center;
      }

      .azkar-text {
        font-size: 1.1em;
        line-height: 1.8;
        text-align: right;
        direction: rtl;
        margin-bottom: 10px;
        padding: 15px;
        background: #f8f9fa;
        border-radius: 8px;
        border-right: 4px solid #4c63d2;
      }

      .azkar-translation {
        font-size: 0.95em;
        color: #666;
        font-style: italic;
        margin-bottom: 15px;
      }

      .azkar-counter {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-top: 15px;
      }

      .counter-btn {
        background: #4c63d2;
        color: white;
        border: none;
        padding: 10px 20px;
        border-radius: 25px;
        cursor: pointer;
        font-weight: bold;
        transition: all 0.3s ease;
      }

      .counter-btn:hover {
        background: #3d52b8;
        transform: scale(1.05);
      }

      .counter-display {
        font-size: 1.5em;
        font-weight: bold;
        color: #4c63d2;
      }

      .istighfar-counter {
        text-align: center;
        background: white;
        border-radius: 15px;
        padding: 30px;
        margin-bottom: 20px;
      }

      .istighfar-text {
        font-size: 1.5em;
        line-height: 1.8;
        text-align: center;
        direction: rtl;
        margin-bottom: 20px;
        padding: 20px;
        background: #f8f9fa;
        border-radius: 10px;
        border: 2px solid #4c63d2;
      }

      .big-counter {
        font-size: 3em;
        font-weight: bold;
        color: #4c63d2;
        margin: 20px 0;
      }

      .big-counter-btn {
        background: #4c63d2;
        color: white;
        border: none;
        padding: 20px 40px;
        border-radius: 50px;
        cursor: pointer;
        font-size: 1.2em;
        font-weight: bold;
        transition: all 0.3s ease;
        margin: 10px;
      }

      .big-counter-btn:hover {
        background: #3d52b8;
        transform: scale(1.05);
      }

      .reset-btn {
        background: #ff9800;
        color: white;
        border: none;
        padding: 12px 25px;
        border-radius: 8px;
        cursor: pointer;
        font-weight: bold;
        font-size: 1em;
        transition: all 0.3s ease;
        margin: 5px;
      }

      .reset-btn:hover {
        background: #f57c00;
        transform: scale(1.05);
      }

      .notification {
        position: fixed;
        top: 20px;
        right: 20px;
        background: #4caf50;
        color: white;
        padding: 15px 20px;
        border-radius: 8px;
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
        z-index: 1000;
        transform: translateX(400px);
        transition: transform 0.3s ease;
      }

      .notification.show {
        transform: translateX(0);
      }

      @media (max-width: 768px) {
        .container {
          padding: 10px;
        }

        .header h1 {
          font-size: 2em;
        }

        .prayers-grid,
        .azkar-grid {
          grid-template-columns: 1fr;
        }

        .tabs {
          flex-direction: column;
        }

        .calendar {
          font-size: 0.9em;
        }
      }
    </style>
  </head>
  <body>
    <div class="container">
      <div class="header">
        <h1>🕌 Daily Salah Tracker</h1>
        <p>Track your prayers, dhikr, and daily Islamic practices</p>
      </div>

      <div class="tabs">
        <button class="tab-button active" onclick="switchTab('salah')">
          📿 Today's Salah
        </button>
        <button class="tab-button" onclick="switchTab('calendar')">
          📅 Calendar
        </button>
        <button class="tab-button" onclick="switchTab('istighfar')">
          🤲 Istighfar
        </button>
        <button class="tab-button" onclick="switchTab('azkar')">
          📖 Daily Azkar
        </button>
      </div>

      <!-- Salah Tracker Tab -->
      <div id="salah-tab" class="tab-content active">
        <div class="date-display">
          <h2 id="currentDate"></h2>
        </div>

        <div class="stats-section">
          <div class="stat-card">
            <div class="stat-value" id="todayPrayed">0</div>
            <div class="stat-label">Prayed Today</div>
          </div>
          <div class="stat-card">
            <div class="stat-value" id="totalMissed">0</div>
            <div class="stat-label">Total Missed</div>
          </div>
          <div class="stat-card">
            <div class="stat-value" id="weeklyPercentage">0%</div>
            <div class="stat-label">This Week</div>
          </div>
        </div>

        <div class="prayers-grid" id="prayersGrid">
          <!-- Prayer cards will be generated by JavaScript -->
        </div>

        <div class="section">
          <h2 class="section-title">Missed Prayers to Make Up</h2>
          <div id="missedPrayersList">
            <p style="text-align: center; color: #666">
              No missed prayers - Alhamdulillah! 🎉
            </p>
          </div>
        </div>

        <div style="text-align: center">
          <button class="reset-btn" onclick="resetDay()">
            Reset Today's Prayers
          </button>
        </div>
      </div>

      <!-- Calendar Tab -->
      <div id="calendar-tab" class="tab-content">
        <div class="section">
          <h2 class="section-title">
            Prayer Calendar - Add Previous Missed Prayers
          </h2>
          <div class="calendar-nav">
            <button class="nav-btn" onclick="changeMonth(-1)">
              ← Previous
            </button>
            <h3 id="currentMonth"></h3>
            <button class="nav-btn" onclick="changeMonth(1)">Next →</button>
          </div>

          <div class="calendar-header">
            <div class="day-header">Sun</div>
            <div class="day-header">Mon</div>
            <div class="day-header">Tue</div>
            <div class="day-header">Wed</div>
            <div class="day-header">Thu</div>
            <div class="day-header">Fri</div>
            <div class="day-header">Sat</div>
          </div>

          <div class="calendar" id="calendar">
            <!-- Calendar days will be generated by JavaScript -->
          </div>
        </div>
      </div>

      <!-- Istighfar Tab -->
      <div id="istighfar-tab" class="tab-content">
        <div class="istighfar-counter">
          <h2 class="section-title">Daily Istighfar Counter</h2>
          <div class="istighfar-text">
            أَسْتَغْفِرُ اللَّهَ الْعَظِيمَ الَّذِي لَا إِلَٰهَ إِلَّا هُوَ
            الْحَيُّ الْقَيُّومُ وَأَتُوبُ إِلَيْهِ
          </div>
          <p style="font-style: italic; color: #666; margin-bottom: 20px">
            "I seek forgiveness from Allah the Mighty, whom there is no god but
            He, the Living, the Eternal, and I repent to Him"
          </p>

          <div class="big-counter" id="istighfarCount">0</div>
          <div>
            <button class="big-counter-btn" onclick="incrementIstighfar()">
              Say Istighfar
            </button>
            <button class="reset-btn" onclick="resetIstighfar()">
              Reset Count
            </button>
          </div>
          <p style="margin-top: 15px; color: #666">
            Today's Goal:
            <span style="color: #4c63d2; font-weight: bold">100 times</span>
          </p>
        </div>
      </div>

      <!-- Azkar Tab -->
      <div id="azkar-tab" class="tab-content">
        <div class="azkar-section">
          <h2 class="section-title">Morning Azkar (أذكار الصباح)</h2>
          <div class="azkar-grid" id="morningAzkar">
            <!-- Morning azkar will be generated by JavaScript -->
          </div>
        </div>

        <div class="azkar-section">
          <h2 class="section-title">Evening Azkar (أذكار المساء)</h2>
          <div class="azkar-grid" id="eveningAzkar">
            <!-- Evening azkar will be generated by JavaScript -->
          </div>
        </div>
      </div>
    </div>

    <!-- Modal for calendar day details -->
    <div id="dayModal" class="modal">
      <div class="modal-content">
        <span class="close" onclick="closeDayModal()">&times;</span>
        <h2 id="modalDate"></h2>
        <p>Select missed prayers for this day:</p>
        <div class="prayer-checklist" id="modalPrayers">
          <!-- Prayer checkboxes will be generated -->
        </div>
        <div style="text-align: center; margin-top: 20px">
          <button class="counter-btn" onclick="saveDayPrayers()">
            Save Changes
          </button>
        </div>
      </div>
    </div>

    <div class="notification" id="notification"></div>

    <script>
      const prayers = [
        { name: "Fajr", time: "05:30" },
        { name: "Dhuhr", time: "12:30" },
        { name: "Asr", time: "15:45" },
        { name: "Maghrib", time: "18:15" },
        { name: "Isha", time: "19:45" },
      ];

      const morningAzkarData = [
        {
          arabic: "أَعُوذُ بِاللَّهِ مِنَ الشَّيْطَانِ الرَّجِيمِ",
          translation: "I seek refuge in Allah from Satan, the accursed one.",
          count: 1,
        },
        {
          arabic: "بِسْمِ اللَّهِ الرَّحْمَٰنِ الرَّحِيمِ",
          translation:
            "In the name of Allah, the Most Gracious, the Most Merciful.",
          count: 1,
        },
        {
          arabic: "سُبْحَانَ اللَّهِ وَبِحَمْدِهِ",
          translation: "Glory be to Allah and praise be to Him.",
          count: 100,
        },
      ];

      const eveningAzkarData = [
        {
          arabic: "أَمْسَيْنَا وَأَمْسَى الْمُلْكُ لِلَّهِ",
          translation:
            "We have reached the evening and at this very time unto Allah belongs all sovereignty.",
          count: 1,
        },
        {
          arabic: "اللَّهُمَّ أَنْتَ رَبِّي لَا إِلَٰهَ إِلَّا أَنْتَ",
          translation:
            "O Allah, You are my Lord, none has the right to be worshiped except You.",
          count: 1,
        },
        {
          arabic: "سُبْحَانَ اللَّهِ الْعَظِيمِ وَبِحَمْدِهِ",
          translation:
            "Glory be to Allah the Magnificent and praise be to Him.",
          count: 100,
        },
      ];

      let prayerData = {};
      let missedPrayers = [];
      let weeklyStats = [];
      let istighfarCount = 0;
      let azkarCounters = {};
      let currentCalendarDate = new Date();
      let selectedCalendarDay = null;

      // Load data from browser storage
      function loadData() {
        try {
          const savedPrayerData = localStorage.getItem(
            "islamicTracker_salahData"
          );
          const savedMissedPrayers = localStorage.getItem(
            "islamicTracker_missedPrayers"
          );
          const savedWeeklyStats = localStorage.getItem(
            "islamicTracker_weeklyStats"
          );
          const savedIstighfar = localStorage.getItem(
            "islamicTracker_istighfarCount"
          );
          const savedAzkarCounters = localStorage.getItem(
            "islamicTracker_azkarCounters"
          );

          if (savedPrayerData) {
            prayerData = JSON.parse(savedPrayerData);
          }
          if (savedMissedPrayers) {
            missedPrayers = JSON.parse(savedMissedPrayers);
          }
          if (savedWeeklyStats) {
            weeklyStats = JSON.parse(savedWeeklyStats);
          }
          if (savedIstighfar) {
            istighfarCount = parseInt(savedIstighfar);
          }
          if (savedAzkarCounters) {
            azkarCounters = JSON.parse(savedAzkarCounters);
          }
        } catch (error) {
          console.log("Error loading data:", error);
        }
        initializeDay();
      }

      function initializeDay() {
        const today = new Date().toDateString();
        if (!prayerData[today]) {
          prayerData[today] = {};
          prayers.forEach((prayer) => {
            prayerData[today][prayer.name] = "pending";
          });
        }
      }

      function saveData() {
        try {
          localStorage.setItem(
            "islamicTracker_salahData",
            JSON.stringify(prayerData)
          );
          localStorage.setItem(
            "islamicTracker_missedPrayers",
            JSON.stringify(missedPrayers)
          );
          localStorage.setItem(
            "islamicTracker_weeklyStats",
            JSON.stringify(weeklyStats)
          );
          localStorage.setItem(
            "islamicTracker_istighfarCount",
            istighfarCount.toString()
          );
          localStorage.setItem(
            "islamicTracker_azkarCounters",
            JSON.stringify(azkarCounters)
          );
        } catch (error) {
          console.log("Error saving data:", error);
        }
      }

      function showNotification(message) {
        const notification = document.getElementById("notification");
        notification.textContent = message;
        notification.classList.add("show");
        setTimeout(() => {
          notification.classList.remove("show");
        }, 3000);
      }

      // Tab switching
      function switchTab(tabName) {
        document.querySelectorAll(".tab-content").forEach((tab) => {
          tab.classList.remove("active");
        });
        document.querySelectorAll(".tab-button").forEach((btn) => {
          btn.classList.remove("active");
        });

        document.getElementById(tabName + "-tab").classList.add("active");
        event.target.classList.add("active");

        if (tabName === "calendar") {
          renderCalendar();
        } else if (tabName === "azkar") {
          renderAzkar();
        } else if (tabName === "istighfar") {
          updateIstighfarDisplay();
        }
      }

      // Prayer management
      function updatePrayerStatus(prayerName, status) {
        const today = new Date().toDateString();
        const oldStatus = prayerData[today][prayerName];
        prayerData[today][prayerName] = status;

        if (status === "missed" && oldStatus !== "missed") {
          missedPrayers.push({
            name: prayerName,
            date: today,
            time: prayers.find((p) => p.name === prayerName).time,
          });
          showNotification(
            `${prayerName} marked as missed. Don't forget to make it up later.`
          );
        } else if (status === "prayed") {
          if (oldStatus === "missed") {
            missedPrayers = missedPrayers.filter(
              (mp) => !(mp.name === prayerName && mp.date === today)
            );
          }
          showNotification(`${prayerName} completed - Barakallahu feek! 🤲`);
        }

        saveData();
        renderPrayers();
        updateStats();
        renderMissedPrayers();
      }

      function makeUpPrayer(index) {
        const prayer = missedPrayers[index];
        missedPrayers.splice(index, 1);
        showNotification(`${prayer.name} made up - May Allah accept it! 🤲`);
        saveData();
        renderMissedPrayers();
        updateStats();
      }

      function renderPrayers() {
        const grid = document.getElementById("prayersGrid");
        const today = new Date().toDateString();

        grid.innerHTML = prayers
          .map((prayer, index) => {
            const status = prayerData[today][prayer.name] || "pending";
            const missedCount = missedPrayers.filter(
              (mp) => mp.name === prayer.name
            ).length;

            return `
                    <div class="prayer-card">
                        <div class="prayer-header">
                            <div class="prayer-name">${prayer.name}</div>
                            <div class="prayer-time">${prayer.time}</div>
                        </div>
                        <div class="prayer-status">
                            <button class="status-btn ${
                              status === "prayed" ? "prayed" : ""
                            }" 
                                    onclick="updatePrayerStatus('${
                                      prayer.name
                                    }', 'prayed')">
                                ✅ Prayed
                            </button>
                            <button class="status-btn ${
                              status === "missed" ? "missed" : ""
                            }" 
                                    onclick="updatePrayerStatus('${
                                      prayer.name
                                    }', 'missed')">
                                ❌ Missed
                            </button>
                        </div>
                        ${
                          missedCount > 0
                            ? `<div class="missed-count">${missedCount} missed to make up</div>`
                            : ""
                        }
                    </div>
                `;
          })
          .join("");
      }

      function renderMissedPrayers() {
        const container = document.getElementById("missedPrayersList");

        if (missedPrayers.length === 0) {
          container.innerHTML =
            '<p style="text-align: center; color: #666;">No missed prayers - Alhamdulillah! 🎉</p>';
          return;
        }

        container.innerHTML = missedPrayers
          .map(
            (prayer, index) => `
                <div class="missed-prayer-item">
                    <div>
                        <strong>${prayer.name}</strong><br>
                        <small>${prayer.date} at ${prayer.time}</small>
                    </div>
                    <button class="make-up-btn" onclick="makeUpPrayer(${index})">
                        Make Up Prayer
                    </button>
                </div>
            `
          )
          .join("");
      }

      function updateStats() {
        const today = new Date().toDateString();
        const todayPrayed = Object.values(prayerData[today] || {}).filter(
          (status) => status === "prayed"
        ).length;
        const totalMissed = missedPrayers.length;

        // Calculate weekly percentage
        const weekStart = new Date();
        weekStart.setDate(weekStart.getDate() - weekStart.getDay());
        let weeklyPrayed = 0;
        let weeklyTotal = 0;

        for (let i = 0; i < 7; i++) {
          const date = new Date(weekStart);
          date.setDate(weekStart.getDate() + i);
          const dateStr = date.toDateString();

          if (prayerData[dateStr] && date <= new Date()) {
            const dayPrayed = Object.values(prayerData[dateStr]).filter(
              (status) => status === "prayed"
            ).length;
            weeklyPrayed += dayPrayed;
            weeklyTotal += 5;
          }
        }

        const weeklyPercentage =
          weeklyTotal > 0 ? Math.round((weeklyPrayed / weeklyTotal) * 100) : 0;

        document.getElementById("todayPrayed").textContent = `${todayPrayed}/5`;
        document.getElementById("totalMissed").textContent = totalMissed;
        document.getElementById(
          "weeklyPercentage"
        ).textContent = `${weeklyPercentage}%`;
      }

      // Calendar functions
      function renderCalendar() {
        const calendar = document.getElementById("calendar");
        const monthYear = document.getElementById("currentMonth");

        const year = currentCalendarDate.getFullYear();
        const month = currentCalendarDate.getMonth();

        monthYear.textContent = currentCalendarDate.toLocaleDateString(
          "en-US",
          {
            month: "long",
            year: "numeric",
          }
        );

        const firstDay = new Date(year, month, 1);
        const lastDay = new Date(year, month + 1, 0);
        const startDate = new Date(firstDay);
        startDate.setDate(startDate.getDate() - firstDay.getDay());

        calendar.innerHTML = "";

        for (let i = 0; i < 42; i++) {
          const currentDate = new Date(startDate);
          currentDate.setDate(startDate.getDate() + i);

          const dateStr = currentDate.toDateString();
          const isCurrentMonth = currentDate.getMonth() === month;
          const isToday = dateStr === new Date().toDateString();
          const missedInDay = missedPrayers.filter(
            (mp) => mp.date === dateStr
          ).length;

          const dayElement = document.createElement("div");
          dayElement.className = "calendar-day";

          if (!isCurrentMonth) {
            dayElement.classList.add("other-month");
          }
          if (isToday) {
            dayElement.classList.add("today");
          }
          if (missedInDay > 0) {
            dayElement.classList.add("has-missed");
          }

          dayElement.innerHTML = `
                    <div class="day-number">${currentDate.getDate()}</div>
                    ${
                      missedInDay > 0
                        ? `<div class="missed-indicator">${missedInDay} missed</div>`
                        : ""
                    }
                `;

          dayElement.onclick = () => openDayModal(currentDate);
          calendar.appendChild(dayElement);
        }
      }

      function changeMonth(direction) {
        currentCalendarDate.setMonth(
          currentCalendarDate.getMonth() + direction
        );
        renderCalendar();
      }

      function openDayModal(date) {
        selectedCalendarDay = date;
        const modal = document.getElementById("dayModal");
        const modalDate = document.getElementById("modalDate");
        const modalPrayers = document.getElementById("modalPrayers");

        modalDate.textContent = date.toLocaleDateString("en-US", {
          weekday: "long",
          year: "numeric",
          month: "long",
          day: "numeric",
        });

        const dateStr = date.toDateString();
        const dayData = prayerData[dateStr] || {};

        modalPrayers.innerHTML = prayers
          .map(
            (prayer) => `
                <div class="prayer-check-item">
                    <label>${prayer.name} (${prayer.time})</label>
                    <select id="prayer-${
                      prayer.name
                    }" onchange="updateModalPrayer('${
              prayer.name
            }', this.value)">
                        <option value="pending" ${
                          (dayData[prayer.name] || "pending") === "pending"
                            ? "selected"
                            : ""
                        }>Not Set</option>
                        <option value="prayed" ${
                          dayData[prayer.name] === "prayed" ? "selected" : ""
                        }>Prayed</option>
                        <option value="missed" ${
                          dayData[prayer.name] === "missed" ? "selected" : ""
                        }>Missed</option>
                    </select>
                </div>
            `
          )
          .join("");

        modal.style.display = "block";
      }

      function closeDayModal() {
        document.getElementById("dayModal").style.display = "none";
      }

      function updateModalPrayer(prayerName, status) {
        // Update the prayer status for the selected day
        const dateStr = selectedCalendarDay.toDateString();
        if (!prayerData[dateStr]) {
          prayerData[dateStr] = {};
        }

        const oldStatus = prayerData[dateStr][prayerName];
        prayerData[dateStr][prayerName] = status;

        // Handle missed prayers list
        if (status === "missed" && oldStatus !== "missed") {
          const prayerTime = prayers.find((p) => p.name === prayerName).time;
          missedPrayers.push({
            name: prayerName,
            date: dateStr,
            time: prayerTime,
          });
        } else if (status !== "missed" && oldStatus === "missed") {
          missedPrayers = missedPrayers.filter(
            (mp) => !(mp.name === prayerName && mp.date === dateStr)
          );
        }
      }

      function saveDayPrayers() {
        saveData();
        closeDayModal();
        renderCalendar();
        if (document.getElementById("salah-tab").classList.contains("active")) {
          updateStats();
          renderMissedPrayers();
        }
        showNotification("Prayer data updated successfully!");
      }

      // Istighfar functions
      function incrementIstighfar() {
        istighfarCount++;
        updateIstighfarDisplay();
        saveData();

        if (istighfarCount % 10 === 0) {
          showNotification(
            `Istighfar count: ${istighfarCount} - Keep going! 🤲`
          );
        }
      }

      function resetIstighfar() {
        if (confirm("Are you sure you want to reset your Istighfar count?")) {
          istighfarCount = 0;
          updateIstighfarDisplay();
          saveData();
          showNotification("Istighfar count reset.");
        }
      }

      function updateIstighfarDisplay() {
        document.getElementById("istighfarCount").textContent = istighfarCount;
      }

      // Azkar functions
      function renderAzkar() {
        renderAzkarSection("morningAzkar", morningAzkarData, "morning");
        renderAzkarSection("eveningAzkar", eveningAzkarData, "evening");
      }

      function renderAzkarSection(containerId, azkarData, type) {
        const container = document.getElementById(containerId);

        container.innerHTML = azkarData
          .map((azkar, index) => {
            const counterId = `${type}-${index}`;
            const currentCount = azkarCounters[counterId] || 0;

            return `
                    <div class="azkar-card">
                        <div class="azkar-title">${
                          type === "morning" ? "Morning" : "Evening"
                        } Dhikr ${index + 1}</div>
                        <div class="azkar-text">${azkar.arabic}</div>
                        <div class="azkar-translation">${
                          azkar.translation
                        }</div>
                        <div class="azkar-counter">
                            <div>
                                <span>Target: ${azkar.count}</span><br>
                                <span class="counter-display">${currentCount}/${
              azkar.count
            }</span>
                            </div>
                            <div>
                                <button class="counter-btn" onclick="incrementAzkar('${counterId}', ${
              azkar.count
            })">
                                    Say Dhikr
                                </button>
                                <button class="reset-btn" onclick="resetAzkar('${counterId}')">Reset</button>
                            </div>
                        </div>
                    </div>
                `;
          })
          .join("");
      }

      function incrementAzkar(counterId, target) {
        if (!azkarCounters[counterId]) {
          azkarCounters[counterId] = 0;
        }

        if (azkarCounters[counterId] < target) {
          azkarCounters[counterId]++;
          saveData();
          renderAzkar();

          if (azkarCounters[counterId] === target) {
            showNotification("Dhikr completed! Barakallahu feek! 🤲");
          }
        } else {
          showNotification(
            "Target already reached! You can continue if you wish."
          );
          azkarCounters[counterId]++;
          saveData();
          renderAzkar();
        }
      }

      function resetAzkar(counterId) {
        azkarCounters[counterId] = 0;
        saveData();
        renderAzkar();
        showNotification("Dhikr counter reset.");
      }

      function resetDay() {
        if (confirm("Are you sure you want to reset today's prayer status?")) {
          const today = new Date().toDateString();
          prayers.forEach((prayer) => {
            prayerData[today][prayer.name] = "pending";
          });
          saveData();
          renderPrayers();
          updateStats();
          showNotification("Today's prayers reset successfully.");
        }
      }

      function updateDate() {
        const now = new Date();
        const options = {
          weekday: "long",
          year: "numeric",
          month: "long",
          day: "numeric",
        };
        document.getElementById("currentDate").textContent =
          now.toLocaleDateString("en-US", options);
      }

      // Initialize the app
      function init() {
        updateDate();
        loadData();
        renderPrayers();
        updateStats();
        renderMissedPrayers();
        updateIstighfarDisplay();

        // Update date every minute
        setInterval(updateDate, 60000);
      }

      // Start the app when page loads
      document.addEventListener("DOMContentLoaded", init);

      // Close modal when clicking outside of it
      window.onclick = function (event) {
        const modal = document.getElementById("dayModal");
        if (event.target === modal) {
          closeDayModal();
        }
      };
    </script>
  </body>
</html>
